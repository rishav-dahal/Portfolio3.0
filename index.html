<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blog Posts</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 0 15px;
            background: #f9f9f9;
        }
        .blog-post {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .blog-post img.cover {
            max-width: 100%;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .blog-post h2 {
            margin-top: 0;
        }
        .blog-meta {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 15px;
        }
        .blog-meta span {
            margin-right: 10px;
        }
        .tags, .categories {
            display: inline-block;
        }
        .tag, .category {
            background: #e0e0e0;
            color: #333;
            padding: 2px 8px;
            border-radius: 4px;
            margin-right: 5px;
            font-size: 0.85em;
        }
    </style>
</head>
<body>

    <h1>Blog Posts</h1>
    <div id="blog-container"></div>

    <!-- Include Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        const container = document.getElementById('blog-container');

        async function fetchBlogs() {
            try {
                const response = await fetch('http://127.0.0.1:8000/blog/list-blogs/');
                if (!response.ok) throw new Error('Network response was not ok');

                const blogs = await response.json();

                blogs.forEach(blog => {
                    const postEl = document.createElement('div');
                    postEl.className = 'blog-post';

                    // Cover image
                    if(blog.cover_image) {
                        const imgEl = document.createElement('img');
                        imgEl.src = blog.cover_image;
                        imgEl.alt = blog.title;
                        imgEl.className = 'cover';
                        postEl.appendChild(imgEl);
                    }

                    // Title
                    const titleEl = document.createElement('h2');
                    titleEl.textContent = blog.title;
                    postEl.appendChild(titleEl);

                    // Meta: published_at, categories, tags
                    const metaEl = document.createElement('div');
                    metaEl.className = 'blog-meta';

                    // Published date
                    const pubDate = document.createElement('span');
                    pubDate.textContent = `Published: ${blog.published_at || 'Draft'}`;
                    metaEl.appendChild(pubDate);

                    // Categories
                    if(blog.categories && blog.categories.length > 0) {
                        const catSpan = document.createElement('span');
                        catSpan.className = 'categories';
                        blog.categories.forEach(cat => {
                            const c = document.createElement('span');
                            c.className = 'category';
                            c.textContent = cat;
                            catSpan.appendChild(c);
                        });
                        metaEl.appendChild(catSpan);
                    }

                    // Tags
                    if(blog.tags && blog.tags.length > 0) {
                        const tagSpan = document.createElement('span');
                        tagSpan.className = 'tags';
                        blog.tags.forEach(tag => {
                            const t = document.createElement('span');
                            t.className = 'tag';
                            t.textContent = tag;
                            tagSpan.appendChild(t);
                        });
                        metaEl.appendChild(tagSpan);
                    }

                    postEl.appendChild(metaEl);

                    // Content (Markdown â†’ HTML)
                    const contentEl = document.createElement('div');
                    contentEl.innerHTML = marked.parse(blog.content);
                    postEl.appendChild(contentEl);

                    container.appendChild(postEl);
                });

            } catch (error) {
                console.error('Error fetching blogs:', error);
                container.textContent = 'Failed to load blog posts.';
            }
        }

        fetchBlogs();
    </script>

</body>
</html>
